!function(t,n,o,i){function e(n,o){this.element=n,this.options=t.extend({},a,o),this._defaults=a,this._name=r,this.init()}function s(t,n,o){n||(n=250);var i,e;return function(){var s=o||this,r=+new Date,a=arguments;i&&i+n>r?(clearTimeout(e),e=setTimeout(function(){i=r,t.apply(s,a)},n)):(i=r,t.apply(s,a))}}var r="ptrLight",a={paused:!1,pullThreshold:200,maxPullThreshold:500,spinnerTimeout:1e4,scrollingDom:null,throttleTimeout:10,allowPtrWhenStartedWhileScrolled:!1,refresh:function(){console.warn('Refresh detected. Please specify a "refresh" function in the ptrLight options object in order to actually get things done.')}};e.prototype={init:function(){var i=this,e=t(i.element);i.elem=e,e.parent().find("#ptr-light-indicator").remove(),e.parent().prepend('<div id="ptr-light-indicator"><div id="ptr-light-spinner"></div></div>'),i.indicator=e.parent().find("#ptr-light-indicator"),i.spinner=e.parent().find("#ptr-light-spinner"),i.doneTimeout=null,i.inProgress=!1,i.inProgressTouchstart=!1,i.indicatorHeight=i.indicator.outerHeight(),i.options.throttleTimeout<1&&(i.options.throttleTimeout=1),t(e).css({transform:"translateY(-"+i.indicatorHeight+"px)"}),e.parent().css({"-webkit-overflow-scrolling":"touch"});var a=e.parent().offset()?e.parent().offset().top:0,p=0,c=0;i.isSpinning=!1,i.elast=!0,i.spinnerRotation=0,i.windowDimension=t(n).height(),i.getTopTranslation=function(t){return(1-1/(.55*t/i.windowDimension+1))*i.windowDimension},i.spinner.css("opacity","0"),e.unbind("touchstart."+r),e.on("touchstart."+r,function(t){return i.inProgressTouchstart=i.inProgress||!i.options.allowPtrWhenStartedWhileScrolled&&(i.options.scrollingDom||e.parent()).scrollTop()>0,i.options.paused||i.inProgress?!1:void(p=t.originalEvent.touches[0].pageY-a)}),e.unbind("touchmove."+r),e.on("touchmove."+r,s(function(n){if(i.inProgress||i.inProgressTouchstart||i.options.paused)return!1;if((i.options.scrollingDom||e.parent()).scrollTop()>0||e.position().top<0||o.body.scrollTop>0)return i.spinner.css("opacity","0"),!0;if(c=n.originalEvent.touches[0].pageY-a-p,c>1){if(i.elast&&(t(o.body).on("touchmove."+r,function(t){t.preventDefault()}),i.elast=!1),c<=i.options.maxPullThreshold){var s=i.getTopTranslation(c);t(e).css({transform:"translateY("+(s-i.indicatorHeight)+"px)"}),i.indicator.css({top:s-i.indicatorHeight+"px"}),i.spinnerRotation=360*(c/i.options.pullThreshold),i.spinnerRotation=i.spinnerRotation>359?360:i.spinnerRotation,i.spinner.css({transform:"rotate("+i.spinnerRotation+"deg)",opacity:"1"})}}else t(o.body).unbind("touchmove."+r),i.elast=!0},i.options.throttleTimeout)),e.unbind("touchend."+r),e.on("touchend."+r,function(n){return i.options.paused||i.inProgress?!1:(c>0&&setTimeout(function(){c>i.options.pullThreshold?(i.inProgress=!0,i.options.refresh.call(this,i),i.spinner.addClass("rotateLoop"),i.isSpinning=!0,e.css({transform:"translateY(0)",transition:"transform 300ms ease"}),i.indicator.css({top:"0px",transition:"top 300ms ease"}),i.options.spinnerTimeout&&(i.doneTimeout&&clearTimeout(i.doneTimeout),i.doneTimeout=setTimeout(function(){i.done()},i.options.spinnerTimeout))):(i.spinnerRotation=0,i.indicator.css({top:"-"+i.indicatorHeight+"px",transition:"top 300ms ease"}),e.css({transform:"translateY(-"+i.indicatorHeight+"px)",transition:"transform 300ms ease"})),c=0},i.options.throttleTimeout+1),void setTimeout(function(){e.css({transition:""}),i.indicator.css({transition:""}),t(o.body).unbind("touchmove."+r),i.elast=!0},300))})},done:function(){var n=this,i=n.elem;n.doneTimeout&&(clearTimeout(n.doneTimeout),n.doneTimeout=null),n.indicator.css({top:"-"+n.indicatorHeight+"px",transition:"top 300ms ease"}),i.css({transform:"translateY(-"+n.indicatorHeight+"px)",transition:"transform 300ms ease"}),setTimeout(function(){n.spinner.removeClass("rotateLoop"),n.isSpinning=!1,n.spinnerRotation=0,n.spinner.css("opacity","0"),i.css({transition:""}),n.indicator.css({transition:""}),t(o.body).unbind("touchmove."+r),n.elast=!0,n.inProgress=!1},300)}},t.fn[r]=function(n){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new e(this,n))})}}(jQuery,window,document);