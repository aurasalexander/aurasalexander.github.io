!function(t,o,n,e){function i(o,n){this.element=o,this.options=t.extend({},a,n),this._defaults=a,this._name=r,this.init()}function s(t,o,n){o||(o=250);var e,i;return function(){var s=n||this,r=+new Date,a=arguments;e&&e+o>r?(clearTimeout(i),i=setTimeout(function(){e=r,t.apply(s,a)},o)):(e=r,t.apply(s,a))}}var r="ptrLight",a={paused:!1,pullThreshold:200,maxPullThreshold:500,spinnerTimeout:1e4,scrollingDom:null,throttleTimeout:10,allowPtrWhenStartedWhileScrolled:!1,refresh:function(){console.warn('Refresh detected. Please specify a "refresh" function in the ptrLight options object in order to actually get things done.')}};i.prototype={init:function(){var i=this,a=t(i.element);i.elem=a,i.elemNode=a[0],a.parent().find("#ptr-light-indicator").remove(),a.parent().prepend('<div id="ptr-light-indicator"><div id="ptr-light-spinner"></div></div>'),i.indicator=a.parent().find("#ptr-light-indicator"),i.indicatorNode=i.indicator[0],i.spinner=a.parent().find("#ptr-light-spinner"),i.spinnerNode=i.spinner[0],i.doneTimeout=null,i.inProgress=!1,i.inProgressTouchstart=!1,i.indicatorHeight=i.indicator.outerHeight(),i.transformProp=i.elemNode.style.transform===e?"-webkit-transform":"transform",i.options.throttleTimeout<1&&(i.options.throttleTimeout=1),i.elemNode.style[i.transformProp]="translateY(-"+i.indicatorHeight+"px)",a.parent().css({"-webkit-overflow-scrolling":"touch"});var p=a.parent().offset()?a.parent().offset().top:0,l=0,d=0;i.isSpinning=!1,i.elast=!0,i.spinnerRotation=0,i.windowDimension=t(o).height(),i.getTopTranslation=function(t){return(1-1/(.55*t/i.windowDimension+1))*i.windowDimension},i.spinner.css("opacity","0"),a.unbind("touchstart."+r),a.on("touchstart."+r,function(t){return i.inProgressTouchstart=i.inProgress||!i.options.allowPtrWhenStartedWhileScrolled&&(i.options.scrollingDom||a.parent()).scrollTop()>0,i.options.paused||i.inProgress?!1:void(l=t.originalEvent.touches[0].pageY-p)}),a.unbind("touchmove."+r),a.on("touchmove."+r,s(function(o){if(i.inProgress||i.inProgressTouchstart||i.options.paused)return!1;if((i.options.scrollingDom||a.parent()).scrollTop()>0||a.position().top<0||n.body.scrollTop>0)return i.spinner.css("opacity","0"),!0;if(d=o.originalEvent.touches[0].pageY-p-l,d>1){if(i.elast&&(t(n.body).on("touchmove."+r,function(t){t.preventDefault()}),i.elast=!1),d<=i.options.maxPullThreshold){var e=i.getTopTranslation(d);i.elemNode.style[i.transformProp]="translateY("+(e-i.indicatorHeight)+"px)",i.indicatorNode.style.top=e-i.indicatorHeight+"px",i.spinnerRotation=360*(d/i.options.pullThreshold),i.spinnerRotation=i.spinnerRotation>359?360:i.spinnerRotation;var s=i.spinnerRotation>300?1-(360-i.spinnerRotation)/600*4:.6;i.spinnerNode.style[i.transformProp]="rotate("+i.spinnerRotation+"deg)",i.spinnerNode.style.opacity=s}}else t(n.body).unbind("touchmove."+r),i.elast=!0},i.options.throttleTimeout)),a.unbind("touchend."+r),a.on("touchend."+r,function(o){return i.options.paused||i.inProgress?!1:(d>0&&setTimeout(function(){d>i.options.pullThreshold?(i.inProgress=!0,i.options.refresh.call(this,i),i.spinner.addClass("rotateLoop"),i.isSpinning=!0,i.elemNode.style[i.transformProp]="translateY(0)",i.elemNode.style.transition="transform 300ms ease",i.indicator.css({top:"0px",transition:"top 300ms ease"}),i.options.spinnerTimeout&&(i.doneTimeout&&clearTimeout(i.doneTimeout),i.doneTimeout=setTimeout(function(){i.done()},i.options.spinnerTimeout))):(i.spinnerRotation=0,i.indicator.css({top:"-"+i.indicatorHeight+"px",transition:"top 300ms ease"}),i.elemNode.style[i.transformProp]="translateY(-"+i.indicatorHeight+"px)",i.elemNode.style.transition="transform 300ms ease"),d=0},i.options.throttleTimeout+1),void setTimeout(function(){a.css({transition:""}),i.indicator.css({transition:""}),t(n.body).unbind("touchmove."+r),i.elast=!0},300))})},done:function(){var o=this,e=o.elem;o.doneTimeout&&(clearTimeout(o.doneTimeout),o.doneTimeout=null),o.indicator.css({top:"-"+o.indicatorHeight+"px",transition:"top 300ms ease"}),o.elemNode.style[o.transformProp]="translateY(-"+o.indicatorHeight+"px)",o.elemNode.style.transition="transform 300ms ease",setTimeout(function(){o.spinner.removeClass("rotateLoop"),o.isSpinning=!1,o.spinnerRotation=0,o.spinner.css("opacity","0"),e.css({transition:""}),o.indicator.css({transition:""}),t(n.body).unbind("touchmove."+r),o.elast=!0,o.inProgress=!1},300)}},t.fn[r]=function(o){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new i(this,o))})}}(jQuery,window,document);