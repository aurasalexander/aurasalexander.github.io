!function(n,t,i,o){function s(t,i){this.element=t,this.options=n.extend({},a,i),this._defaults=a,this._name=r,this.init()}function e(n,t,i){t||(t=250);var o,s;return function(){var e=i||this,r=+new Date,a=arguments;o&&o+t>r?(clearTimeout(s),s=setTimeout(function(){o=r,n.apply(e,a)},t)):(o=r,n.apply(e,a))}}var r="ptrLight",a={paused:!1,pullThreshold:200,maxPullThreshold:500,spinnerTimeout:1e4,scrollingDom:null,refresh:function(){}};s.prototype={init:function(){var o=this,s=n(o.element).children();o.elem=s,s.parent().find("#ptr-light-indicator").remove(),s.parent().prepend('<div id="ptr-light-indicator"><div id="ptr-light-spinner"></div></div>'),o.indicator=s.parent().find("#ptr-light-indicator"),o.spinner=s.parent().find("#ptr-light-spinner"),o.doneTimeout=null,o.inProgress=!1,o.inProgressTouchstart=!1,o.indicatorHeight=o.indicator.outerHeight(),n(s).css({transform:"translateY(-"+o.indicatorHeight+"px)"}),s.parent().css({"-webkit-overflow-scrolling":"touch"});var a=s.parent().offset().top,p=0,c=0;o.isSpinning=!1,o.elast=!0,o.spinnerRotation=0,o.windowDimension=n(t).height(),o.getTopTranslation=function(n){return(1-1/(.55*n/o.windowDimension+1))*o.windowDimension},o.spinner.css("opacity","0"),s.unbind("touchstart."+r),s.on("touchstart."+r,function(n){return o.inProgressTouchstart=o.inProgress,o.options.paused||o.inProgress?!1:void(p=n.originalEvent.touches[0].pageY-a)}),s.unbind("touchmove."+r),s.on("touchmove."+r,e(function(t){if(o.inProgress||o.inProgressTouchstart||o.options.paused)return!1;if((o.options.scrollingDom||s.parent()).scrollTop()>0||s.position().top<0||i.body.scrollTop>0)return o.spinner.css("opacity","0"),!0;if(c=t.originalEvent.touches[0].pageY-a-p,c>1){if(o.elast&&(n(i.body).on("touchmove."+r,function(n){n.preventDefault()}),o.elast=!1),c<=o.options.maxPullThreshold){var e=o.getTopTranslation(c);n(s).css({transform:"translateY("+(e-o.indicatorHeight)+"px)"}),o.indicator.css({top:e-o.indicatorHeight+"px"}),o.spinnerRotation=o.spinnerRotation>359?360:360*(c/o.options.pullThreshold),o.spinner.css({opacity:"1",transform:"rotate("+o.spinnerRotation+"deg)"})}}else n(i.body).unbind("touchmove."+r),o.elast=!0},25)),s.unbind("touchend."+r),s.on("touchend."+r,function(t){return o.options.paused||o.inProgress?!1:(c>0&&(c>o.options.pullThreshold?(o.inProgress=!0,o.options.refresh.call(this,o),o.spinner.addClass("rotateLoop"),o.isSpinning=!0,s.css({transform:"translateY(0)",transition:"transform 300ms ease"}),o.indicator.css({top:"0px",transition:"top 300ms ease"}),o.options.spinnerTimeout&&(o.doneTimeout&&clearTimeout(o.doneTimeout),o.doneTimeout=setTimeout(function(){o.done()},o.options.spinnerTimeout))):(o.indicator.css({top:"-"+o.indicatorHeight+"px",transition:"top 300ms ease"}),s.css({transform:"translateY(-"+o.indicatorHeight+"px)",transition:"transform 300ms ease"})),c=0),void setTimeout(function(){s.css({transition:""}),o.indicator.css({transition:""}),n(i.body).unbind("touchmove."+r),o.elast=!0},300))})},done:function(){var t=this,o=t.elem;t.doneTimeout&&(clearTimeout(t.doneTimeout),t.doneTimeout=null),t.indicator.css({top:"-"+t.indicatorHeight+"px",transition:"top 300ms ease"}),o.css({transform:"translateY(-"+t.indicatorHeight+"px)",transition:"transform 300ms ease"}),setTimeout(function(){t.spinner.removeClass("rotateLoop"),t.isSpinning=!1,t.spinnerRotation=0,t.spinner.css("opacity","0"),o.css({transition:""}),t.indicator.css({transition:""}),n(i.body).unbind("touchmove."+r),t.elast=!0,t.inProgress=!1},300)}},n.fn[r]=function(t){return this.each(function(){n.data(this,"plugin_"+r)||n.data(this,"plugin_"+r,new s(this,t))})}}(jQuery,window,document);