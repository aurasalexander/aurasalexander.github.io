!function(t,n,o,e){function i(n,o){this.element=n,this.options=t.extend({},a,o),this._defaults=a,this._name=r,this.init()}function s(t,n,o){n||(n=250);var e,i;return function(){var s=o||this,r=+new Date,a=arguments;e&&e+n>r?(clearTimeout(i),i=setTimeout(function(){e=r,t.apply(s,a)},n)):(e=r,t.apply(s,a))}}var r="ptrLight",a={paused:!1,pullThreshold:200,maxPullThreshold:500,spinnerTimeout:1e4,scrollingDom:null,throttleTimeout:10,allowPtrWhenStartedWhileScrolled:!1,refresh:function(){console.warn('Refresh detected. Please specify a "refresh" function in the ptrLight options object in order to actually get things done.')}};i.prototype={init:function(){var e=this,i=t(e.element);e.elem=i,e.elemNode=i[0],i.parent().find("#ptr-light-indicator").remove(),i.parent().prepend('<div id="ptr-light-indicator"><div id="ptr-light-spinner"></div></div>'),e.indicator=i.parent().find("#ptr-light-indicator"),e.indicatorNode=e.indicator[0],e.spinner=i.parent().find("#ptr-light-spinner"),e.spinnerNode=e.spinner[0],e.doneTimeout=null,e.inProgress=!1,e.inProgressTouchstart=!1,e.indicatorHeight=e.indicator.outerHeight(),e.options.throttleTimeout<1&&(e.options.throttleTimeout=1),e.elemNode.style.transform="translateY(-"+e.indicatorHeight+"px)",i.parent().css({"-webkit-overflow-scrolling":"touch"});var a=i.parent().offset()?i.parent().offset().top:0,l=0,p=0;e.isSpinning=!1,e.elast=!0,e.spinnerRotation=0,e.windowDimension=t(n).height(),e.getTopTranslation=function(t){return(1-1/(.55*t/e.windowDimension+1))*e.windowDimension},e.spinner.css("opacity","0"),i.unbind("touchstart."+r),i.on("touchstart."+r,function(t){return e.inProgressTouchstart=e.inProgress||!e.options.allowPtrWhenStartedWhileScrolled&&(e.options.scrollingDom||i.parent()).scrollTop()>0,e.options.paused||e.inProgress?!1:void(l=t.originalEvent.touches[0].pageY-a)}),i.unbind("touchmove."+r),i.on("touchmove."+r,s(function(n){if(e.inProgress||e.inProgressTouchstart||e.options.paused)return!1;if((e.options.scrollingDom||i.parent()).scrollTop()>0||i.position().top<0||o.body.scrollTop>0)return e.spinner.css("opacity","0"),!0;if(p=n.originalEvent.touches[0].pageY-a-l,p>1){if(e.elast&&(t(o.body).on("touchmove."+r,function(t){t.preventDefault()}),e.elast=!1),p<=e.options.maxPullThreshold){var s=e.getTopTranslation(p);e.elemNode.style.transform="translateY("+(s-e.indicatorHeight)+"px)",e.indicatorNode.style.top=s-e.indicatorHeight+"px",e.spinnerRotation=360*(p/e.options.pullThreshold),e.spinnerRotation=e.spinnerRotation>359?360:e.spinnerRotation;var d=e.spinnerRotation>300?1-(360-e.spinnerRotation)/600*4:.6;e.spinnerNode.style.transform="rotate("+e.spinnerRotation+"deg)",e.spinnerNode.style.opacity=d}}else t(o.body).unbind("touchmove."+r),e.elast=!0},e.options.throttleTimeout)),i.unbind("touchend."+r),i.on("touchend."+r,function(n){return e.options.paused||e.inProgress?!1:(p>0&&setTimeout(function(){p>e.options.pullThreshold?(e.inProgress=!0,e.options.refresh.call(this,e),e.spinner.addClass("rotateLoop"),e.isSpinning=!0,e.elemNode.style.transform="translateY(0)",e.elemNode.style.transition="transform 300ms ease",e.indicator.css({top:"0px",transition:"top 300ms ease"}),e.options.spinnerTimeout&&(e.doneTimeout&&clearTimeout(e.doneTimeout),e.doneTimeout=setTimeout(function(){e.done()},e.options.spinnerTimeout))):(e.spinnerRotation=0,e.indicator.css({top:"-"+e.indicatorHeight+"px",transition:"top 300ms ease"}),e.elemNode.style.transform="translateY(-"+e.indicatorHeight+"px)",e.elemNode.style.transition="transform 300ms ease"),p=0},e.options.throttleTimeout+1),void setTimeout(function(){i.css({transition:""}),e.indicator.css({transition:""}),t(o.body).unbind("touchmove."+r),e.elast=!0},300))})},done:function(){var n=this,e=n.elem;n.doneTimeout&&(clearTimeout(n.doneTimeout),n.doneTimeout=null),n.indicator.css({top:"-"+n.indicatorHeight+"px",transition:"top 300ms ease"}),n.elemNode.style.transform="translateY(-"+n.indicatorHeight+"px)",n.elemNode.style.transition="transform 300ms ease",setTimeout(function(){n.spinner.removeClass("rotateLoop"),n.isSpinning=!1,n.spinnerRotation=0,n.spinner.css("opacity","0"),e.css({transition:""}),n.indicator.css({transition:""}),t(o.body).unbind("touchmove."+r),n.elast=!0,n.inProgress=!1},300)}},t.fn[r]=function(n){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new i(this,n))})}}(jQuery,window,document);